<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:#f2f6ff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .wrap{background:#fff;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.1);padding:30px;max-width:440px;width:100%}
    h2{text-align:center;margin:0 0 16px}
    label{font-weight:600;display:block;margin:10px 0 6px}
    select,input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px}
    .btn{width:100%;padding:12px;border:none;border-radius:8px;color:#fff;font-weight:700;margin-top:12px;cursor:pointer}
    .go{background:#388e3c}.go:hover{background:#43a047}
    .back{background:#d84315}.back:hover{background:#e64a19}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Create Account</h2>
    {% with messages = get_flashed_messages() %}
      {% if messages %}<ul style="color:red">{% for m in messages %}<li>{{m}}</li>{% endfor %}</ul>{% endif %}
    {% endwith %}
    <form method="POST">
      <label>Role</label>
      <select name="role" required>
        <option value="patient">Patient</option>
        <option value="doctor">Doctor</option>
      </select>
      <label>Full Name</label>
      <input name="name" required pattern="^[A-Za-z][A-Za-z\\s]{1,49}$" title="Letters and spaces only">
      <label>Email</label>
      <input type="email" name="email" required>
      <label>Phone (optional)</label>
      <input name="phone">
      <label>Password</label>
      <input type="password" name="password" required>
      <div id="doctorFields" style="display:none">
        <label>Department</label>
        <select name="department_id" id="deptSelect">
          <option value="">-- Select Department --</option>
          {% for d in departments %}
          <option value="{{ d.id }}">{{ d.name }}</option>
          {% endfor %}
        </select>
        <label>Consultation Fee (â‚¹)</label>
        <input type="number" step="0.01" name="fee" placeholder="500">
      </div>
      <button class="btn go" type="submit">Register</button>
      <button type="button" class="btn back" onclick="location.href='{{ url_for('login') }}'">Back to Login</button>
    </form>
  </div>
  <script>
    const roleSel=document.querySelector('select[name=role]');
    const docBox=document.getElementById('doctorFields');
    function toggle(){ docBox.style.display = roleSel.value==='doctor' ? 'block':'none'; }
    roleSel.addEventListener('change', toggle); toggle();
  </script>
</body>
</html>